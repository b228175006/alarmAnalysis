# 历史告警数据分析实现设计
[TOC]
## 1.概述
根据`《历史告警数据分析需求设计》`中对“告警数据场景分析”的需求进行数据清洗和挖掘的方法的设计

## 2.不同告警数据场景的挖掘方法
告警数据场景有告警压缩、告警过滤、告警抑制、告警计数、告警泛化、告警特化、告警时序关系、超历时告警共8中场景，其中告警泛化、告警特化未涉及数据分析内容，超时告警不在历史告警数据中，所需分析的只有告警压缩、告警过滤、告警抑制、告警计数、告警时序关系。根据每种场景的需求不同，在数据挖掘方式上使用不同的方法。

### 1. 告警压缩：
>将发生的多个告警压缩到一个告警中，适用于相同网元，具有相同特征的重复告警，如同一设备在短时间内发送的相同类型的告警。

在`一定时间范围内`（3s），相同`告警对象`产生的相同`告警名称`且具有相同`关键字（厂家提供的设备原始标识）`的告警可判断为重复告警，在此时间段内的重复告警只保留一条

### 2. 告警过滤：
> 如果告警代表的含义并非故障，则将其过滤掉，适用于系统配置改变、性能异常等告警形式。

通过关联资源对象、告警名称进行判断此告警数据是否为故障的报警，只保留由故障引起的告警信息

1. 如果告警信息无关联资源对象，肯定不是故障告警
2. 如果告警信息有关联资源对象，则判断告警名称是否为`LOS告警`，是LOS告警可判定为故障告警

### 3. 告警抑制：
> 在主要告警发生的情况下，抑制次要告警，适用于一条告警（主要告警）出现会产生一条或多条其他告警（次要告警）的主次告警场景。主次告警可分为无资源关系和有资源关系两类。无资源关系的主次告警，指主要告警和次要告警没有资源关联关系，只有业务特征关系。有资源关系的主次告警，指主要告警和次要告警有资源关联关系，如父子网元关系、关联网元关系。

~~目前只进行有资源关系的告警数据进行告警抑制~~

1. 从oracle数据表中获取资源关系属性（自身资源属性，关联资源属性)
2. 寻找入口数据
    * 有资源关联关系的告警数据，根据关联关系确定入口
        - 父子关系网元取父网元为入口
        - 汇聚层网元需要根据各个网元的连接数确定汇聚层网元入口；
            + 对所有网元的链接数进行统计，根据统计结果和实际数据进行对比，确定汇聚层网元判断的最低连接数
            + 根据判断汇聚层网元的最低连接数，确定汇聚层网元告警信息的入口
    * 无资源关联关系的告警数据，按照告警发生时间进行聚类，确定入口（聚类方法）
3. 根据入口告警发生时间的前后范围、同步发生时间进行分组，根据不同的分组时间进行迭代，找出合适时间范围的分组
4. 对分组结果进行匹配，各分组中除去入口告警，其他的单个告警出现频率达到80%，则认为此单个告警和入口告警有关联关系

### 4. 告警计数：
> 对重复到达的告警记录次数和设定阈值，适用于相同网元具有相同特征的重复告警。和告警压缩不同的是，此处的特征范围有可能比告警压缩时的特征范围更大，此处的告警发生频次更低、时间跨度更长。

### 5. 告警时序关系：
> 相关告警依赖于告警发生时间顺序，适用于无资源关系、无业务特征关系、仅在时间先后上有关联的告警链。


